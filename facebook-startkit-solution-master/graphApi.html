<!DOCTYPE html>
<html>
     <head>
          <meta charset="UTF-8">
          <title>Facebook api</title>						
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
          <link rel="stylesheet" href="css/reset.css">	
          <link rel="stylesheet" href="css/main.css">
          <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
		  
		  <style>
			#container{
				position: absolute;
				top: 145px;
				left: 39%;
			}
			#comment{
				width: 450px;
			}
		  </style>
	</head>
	<body>
		<div
  class="fb-like"
  data-share="true"
  data-width="450"
  data-show-faces="true">
		</div>


	    <header><p class="notLogin">未登入</p><button id="logoutBtn" class="btn btn-danger">登出</button></header>	
	    <article>
			<div id="indexView">
			   <!-- <div id="fbImgView"></div> -->
			   <div id="container">
				    <div class="row">

				       <p>你好&nbsp;&nbsp;<span id="name"></span>，追星還愉快嗎？</p>
				       <p>不管你有什麼想法都歡迎你留言給我們！你的建議會讓追星更美好！</p>
				      <!-- <a href="logIn.html" class="btn">登入</a>
				      <a href="signUp.html" class="btn">註冊</a> -->
				    </div>

				    <div class="row">
				     <br>
				      <h2>留言板</h2>
				      <br><br>

				      <!-- 這一部分要大家去 form builder 做 -->
				      <!-- http://bootsnipp.com/forms?version=3 -->
				      <blockquote>
				        <form id="commentForm" class="form-horizontal">
				          <div class="form-group">
				            <div class="col-md-4">
				              <textarea class="form-control" placeholder="請輸入留言" id="comment" name="comment"></textarea>
				            </div>
				          </div>
				          <!-- Practice 5 儲存圖片 -->
				          <!-- <div class="form-group">
				            <div class="col-md-4"><input type="file" id="fileInput"></div>
				          </div> -->

				          <div class="form-group">
				            <div class="col-md-4"><button id="commentSubmit" name="commentSubmit" class="btn btn-primary">送出</button></div>
				          </div>
				        </form>
				      </blockquote>
				      <div id="comments">
				        <blockquote>
				          
				        </blockquote>
				      </div>
				    </div>
				  </div>
		    </div>
	    	<form id="loginView">
				  <label>username:<input class="form-control" id="username" type="text" placeholder="請輸入使用者名稱..."></label>
				  <label>password:<input class="form-control" id="password" type="password" placeholder="請輸入密碼..."></label>
				  <button id="loginBtn" class="btn btn-success" type="submit">登入</button>
				  <button id="signupBtn" class="btn btn-info" type="submit">註冊</button>
				  <button id="fbloginBtn" class="btn btn-primary" type="submit">臉書登入</button>
			</form>
	    </article>	
		
	<script>
	
		//step1:https://www.parse.com/docs/js/guide#users-facebook-users
		
        // Initialize Parse
        Parse.initialize("Avp2LWPc7XR8vau5shMlzGx6RZD3iyCJMz2CPvPO", "Ajfie2Q3dh4CUnEtbrLwBttD1YvVlDHPiAcBC75w");


        window.fbAsyncInit = function() {
      Parse.FacebookUtils.init({
      appId      : '1652401031642744',
	  status : true, // check Facebook Login status
	  cookie : true, // enable cookies to allow Parse to access the session
	  xfbml : true, // initialize Facebook social plugins on the page
	  version : 'v2.3' // point to the latest Facebook Graph API version
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

		function fblogin(){
		    //step2:https://developers.facebook.com/docs/graph-api/using-graph-api/v2.3	
			
			Parse.FacebookUtils.logIn(null, {
			  success: function(user) {
			    if (!user.existed()) {
			      alert("註冊完成並且透過臉書登入");
			    } else {
			      alert("透過臉書登入成功");
			    }
				indexView();//切換至預先寫好登入後的介面
				FB.getLoginStatus(function(response) {
				     if (response.status === 'connected') {
				         FB.api('/me/picture?type=large', function (response) {
						    $('#fbImgView').html("<h5>Here are your profile photo</h5><img src="+response.data.url+" crossorigin=\"anonymous\" id=preview1 />");          
				         });
						 
				         FB.api('/me', function (response) {
							 console.log(response);
							 $('#fbImgView').append("<h1>Welcome , "+(response['gender']=="male"?"Mr. ":"Miss ")+" "+response['first_name']+"</h1>");
				         });
						
				     }
			     }); 
			  },
			  error: function(user, error) {
			    alert("使用者取消登入或沒有授權");
			  }
			});
		}

	</script>
    <script src="js/graphApi.js"></script>		   	
    </body>
</html>